import{a9 as O,a4 as w,i as k,h as i,ab as M,am as A,ak as n,r as u,x as F,u as E,a as q,an as L,j as e,ad as l,ae as C,a5 as j,B as h,f as N,af as g,ai as z,ag as D,k as H,H as R}from"./index-CHwHWRri.js";const V=O("biling/createTableBiling",async({data:d,tableid:p},{signal:x,dispatch:m})=>{try{const t=w.CancelToken.source();x.addEventListener("abort",()=>t.cancel("Operation canceled by the user."));const c=await k.createTableBiling(d,t.token);return i.success("Successfully created"),console.log(c,"res"),c.data}catch(t){i.error("Ошибка сервера"),console.log(t)}finally{localStorage.removeItem("table_key"),localStorage.removeItem("session_key");const t=M();localStorage.getItem("table_key")||m(A({data:{session_key:`${t}`,menu_table:Number(p),promo_code:!0,discount_amount:0}})).then(y=>{console.log(y),m(n({id:Number(localStorage.getItem("table_key"))}))})}}),{Option:_}=C,K=()=>{var v,S;const[d,p]=u.useState(""),[x,m]=u.useState(0),{tableid:t}=F(),[c,y]=u.useState("bankCard"),a=E(),r=q(s=>s.tableCart.data);u.useEffect(()=>{a(n({id:Number(localStorage.getItem("table_key"))})),a(L({id:Number(t)}))},[a]);const f=s=>{y(s)},T=async s=>{try{await k.deleteTableOrderItemById(s).then(()=>{a(H(s)),a(n({id:Number(localStorage.getItem("table_key"))})),i.success("Товар успешно удалён из корзины")})}catch(o){console.log(o)}},b=(((v=r.items)==null?void 0:v.reduce((s,o)=>s+parseFloat(o.product.price)*o.quantity,0))||0)-x,I=b*.15,B=async s=>{const o=localStorage.getItem("user_id")?{session_key:localStorage.getItem("session_key"),menu_table:Number(t),promo_code:!0,discount_amount:0,user_id:Number(localStorage.getItem("user_id")),...s}:{session_key:localStorage.getItem("session_key"),menu_table:Number(t),promo_code:!0,discount_amount:0,...s};a(V({data:o,tableid:Number(t)})).then(()=>{a(n({id:Number(localStorage.getItem("table_key"))}))})},P=async()=>{try{const s=await k.applyPromoCodeTable({session_key:localStorage.getItem("session_key"),promo_code:d});m(s.data.discount_amount),i.success(s.data.success)}catch{i.error("Не удалось применить промо-код")}finally{a(n({id:Number(localStorage.getItem("table_key"))}))}};return e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"he",children:e.jsx("div",{className:"personal-info-section",children:e.jsxs(l,{onFinish:B,layout:"vertical",children:[e.jsx(l.Item,{initialValue:"bankCard",label:"Метод оплаты",name:"payment_method",children:e.jsxs(C,{defaultValue:"bankCard",onChange:f,children:[e.jsx(_,{value:"bankCard",children:"Банковская карта"}),e.jsx(_,{value:"cash",children:"Наличные"}),e.jsx(_,{value:"eWallet",children:"Электронный кошелек"})]})}),c==="cash"&&e.jsx(l.Item,{label:"Сдача с",name:"client_delivery",children:e.jsx(j,{placeholder:"Введите сумму для сдачи"})}),e.jsx(l.Item,{label:"Комментарий к заказу",name:"note",children:e.jsx(j.TextArea,{rows:3,placeholder:"Укажите тут дополнительную информацию для курьера"})}),e.jsx(l.Item,{children:e.jsx(h,{type:"primary",htmlType:"submit",block:!0,disabled:((S=r.items)==null?void 0:S.length)===0,children:"Оформить заказ"})})]})})}),e.jsxs("div",{className:"order-summary-section he",children:[e.jsxs("div",{className:"",children:[e.jsxs("h2",{children:["Корзина ",e.jsx(h,{icon:e.jsx(N,{}),className:"clear-cart-btn",children:"Очистить корзину"})]}),e.jsx(g,{itemLayout:"horizontal",dataSource:r.items,renderItem:s=>e.jsx(g.Item,{actions:[e.jsxs("div",{className:"rightBar",children:[e.jsx(h,{onClick:()=>T(s.id),style:{width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0px 0px 0px 7px"},type:"text",icon:e.jsx(N,{style:{color:"red"}})}),e.jsx(z,{record:s})]})],children:e.jsx(g.Item.Meta,{avatar:e.jsx(D,{shape:"square",size:"large",style:{height:"100px",width:"100px"},src:s.product.iiko_image}),title:s.product.title,description:e.jsxs("div",{children:[e.jsx("p",{children:s.product.description}),e.jsxs("span",{style:{color:"red"},children:[parseFloat(s.product.price)*s.quantity," c"]})]})})})})]}),e.jsx("br",{}),r.discount_amount>1?"":e.jsxs("div",{className:"promo-code-section",children:[e.jsx("h3",{children:"Введите промо-код:"}),e.jsx(j,{placeholder:"Введите промо-код",value:d,onChange:s=>p(s.target.value),style:{marginBottom:"10px"}}),e.jsx(h,{type:"primary",onClick:P,block:!0,children:"Применить промо-код"})]}),e.jsx("br",{}),e.jsxs("h3",{children:["Итого: ",b+I," c"]}),e.jsxs("div",{className:"order-details",children:[e.jsxs("p",{children:["Стоимость товаров: ",b+r.discount_amount," c"]}),e.jsxs("p",{children:["Обслуживание 15%: ",I," c "]}),e.jsxs("p",{children:["Скидка: ",r.discount_amount," c "]})]})]})]})},$=()=>e.jsxs("div",{children:[e.jsx(R,{children:e.jsx("title",{children:"Mnogosushi | Оформление"})}),e.jsx(K,{})]});export{$ as default};
