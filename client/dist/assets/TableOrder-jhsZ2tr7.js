import{ak as P,ag as O,i as k,h as l,am as w,ax as M,av as h,r as d,x as A,u as F,a as q,ay as E,j as e,ao as c,ap as N,ah as b,B as m,f as C,aq as j,at as L,ar as z,k as D,H}from"./index-BAg2iCvK.js";const R=P("biling/createTableBiling",async({data:n,tableid:u},{signal:p,dispatch:i})=>{try{const t=O.CancelToken.source();p.addEventListener("abort",()=>t.cancel("Operation canceled by the user."));const o=await k.createTableBiling(n,t.token);return l.success("Successfully created"),console.log(o,"res"),o.data}catch(t){l.error("Ошибка сервера"),console.log(t)}finally{localStorage.removeItem("table_key"),localStorage.removeItem("session_key");const t=w();localStorage.getItem("table_key")||i(M({data:{session_key:`${t}`,menu_table:Number(u),promo_code:!0,discount_amount:0}})).then(x=>{console.log(x),i(h({id:Number(localStorage.getItem("table_key"))}))})}}),{Option:g}=N,V=()=>{var I,v;const[n,u]=d.useState(""),[p,i]=d.useState(0),{tableid:t}=A(),[o,x]=d.useState("bankCard"),r=F(),y=q(a=>a.tableCart.data);d.useEffect(()=>{r(h({id:Number(localStorage.getItem("table_key"))})),r(E({id:Number(t)}))},[r]);const S=a=>{x(a)},f=async a=>{try{await k.deleteTableOrderItemById(a).then(()=>{r(D(a)),r(h({id:Number(localStorage.getItem("table_key"))})),l.success("Товар успешно удалён из корзины")})}catch(s){console.log(s)}},_=(((I=y.items)==null?void 0:I.reduce((a,s)=>a+parseFloat(s.product.price)*s.quantity,0))||0)-p,T=async a=>{const s={session_key:localStorage.getItem("session_key"),menu_table:Number(t),promo_code:!0,discount_amount:0,...a};r(R({data:s,tableid:Number(t)})).then(()=>{r(h({id:Number(localStorage.getItem("table_key"))}))})},B=async()=>{try{const a=localStorage.getItem("table_key"),s=await k.applyPromoCode({cart_id:a,promo_code:n});i(s.data.discount_amount),l.success(s.data.success)}catch{l.error("Не удалось применить промо-код")}};return e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"he",children:e.jsx("div",{className:"personal-info-section",children:e.jsxs(c,{onFinish:T,layout:"vertical",children:[e.jsx(c.Item,{initialValue:"bankCard",label:"Метод оплаты",name:"payment_method",children:e.jsxs(N,{defaultValue:"bankCard",onChange:S,children:[e.jsx(g,{value:"bankCard",children:"Банковская карта"}),e.jsx(g,{value:"cash",children:"Наличные"}),e.jsx(g,{value:"eWallet",children:"Электронный кошелек"})]})}),o==="cash"&&e.jsx(c.Item,{label:"Сдача с",name:"client_delivery",children:e.jsx(b,{placeholder:"Введите сумму для сдачи"})}),e.jsx(c.Item,{label:"Комментарий к заказу",name:"note",children:e.jsx(b.TextArea,{rows:3,placeholder:"Укажите тут дополнительную информацию для курьера"})}),e.jsx(c.Item,{children:e.jsx(m,{type:"primary",htmlType:"submit",block:!0,disabled:((v=y.items)==null?void 0:v.length)===0,children:"Оформить заказ"})})]})})}),e.jsxs("div",{className:"order-summary-section he",children:[e.jsxs("div",{className:"",children:[e.jsxs("h2",{children:["Корзина ",e.jsx(m,{icon:e.jsx(C,{}),className:"clear-cart-btn",children:"Очистить корзину"})]}),e.jsx(j,{itemLayout:"horizontal",dataSource:y.items,renderItem:a=>e.jsx(j.Item,{actions:[e.jsxs("div",{className:"rightBar",children:[e.jsx(m,{onClick:()=>f(a.id),style:{width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0px 0px 0px 7px"},type:"text",icon:e.jsx(C,{style:{color:"red"}})}),e.jsx(L,{record:a})]})],children:e.jsx(j.Item.Meta,{avatar:e.jsx(z,{shape:"square",size:"large",style:{height:"100px",width:"100px"},src:a.product.iiko_image}),title:a.product.title,description:e.jsxs("div",{children:[e.jsx("p",{children:a.product.description}),e.jsxs("span",{style:{color:"red"},children:[parseFloat(a.product.price)*a.quantity," c"]})]})})})})]}),e.jsx("br",{}),e.jsxs("div",{className:"promo-code-section",children:[e.jsx("h3",{children:"Введите промо-код:"}),e.jsx(b,{placeholder:"Введите промо-код",value:n,onChange:a=>u(a.target.value),style:{marginBottom:"10px"}}),e.jsx(m,{type:"primary",onClick:B,block:!0,children:"Применить промо-код"})]}),e.jsx("br",{}),e.jsxs("h3",{children:["Итого: ",_," c"]}),e.jsx("div",{className:"order-details",children:e.jsxs("p",{children:["Стоимость товаров: ",_," c"]})})]})]})},W=()=>e.jsxs("div",{children:[e.jsx(H,{children:e.jsx("title",{children:"Mnogosushi | Оформление"})}),e.jsx(V,{})]});export{W as default};
