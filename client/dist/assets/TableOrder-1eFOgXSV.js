import{r as o,x as w,u as B,a as F,at as l,av as M,j as e,am as r,an as g,ah as n,B as c,F as O,f as y,ao as d,ar as T,ap as A,i as b,k as q,h as i,aw as z,H as E}from"./index-DkoJI0s5.js";const{Option:h}=g,D=()=>{var j;const[m,I]=o.useState(""),[v,k]=o.useState(0),{tableid:p}=w(),[C,_]=o.useState("bankCard"),t=B(),x=F(s=>s.tableCart.data);o.useEffect(()=>{t(l({id:Number(localStorage.getItem("table_key"))})),t(M({id:Number(p)}))},[t]);const N=s=>{_(s)},f=async s=>{try{await b.deleteTableOrderItemById(s).then(()=>{t(q(s)),t(l({id:Number(localStorage.getItem("table_key"))})),i.success("Товар успешно удалён из корзины")})}catch(a){console.log(a)}},u=(((j=x.items)==null?void 0:j.reduce((s,a)=>s+parseFloat(a.product.price)*a.quantity,0))||0)-v,S=async s=>{const a={session_key:localStorage.getItem("session_key"),menu_table:Number(p),promo_code:!0,discount_amount:0,...s};t(z({data:a})).then(()=>{t(l({id:Number(localStorage.getItem("table_key"))}))})},P=async()=>{try{const s=localStorage.getItem("table_key"),a=await b.applyPromoCode({cart_id:s,promo_code:m});k(a.data.discount_amount),i.success(a.data.success)}catch{i.error("Не удалось применить промо-код")}};return e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"he",children:e.jsx("div",{className:"personal-info-section",children:e.jsxs(r,{onFinish:S,layout:"vertical",children:[e.jsx(r.Item,{initialValue:"bankCard",label:"Метод оплаты",name:"payment_method",children:e.jsxs(g,{defaultValue:"bankCard",onChange:N,children:[e.jsx(h,{value:"bankCard",children:"Банковская карта"}),e.jsx(h,{value:"cash",children:"Наличные"}),e.jsx(h,{value:"eWallet",children:"Электронный кошелек"})]})}),C==="cash"&&e.jsx(r.Item,{label:"Сдача с",name:"change",children:e.jsx(n,{placeholder:"Введите сумму для сдачи"})}),e.jsx(r.Item,{label:"Комментарий к заказу",name:"comment",children:e.jsx(n.TextArea,{rows:3,placeholder:"Укажите тут дополнительную информацию для курьера"})}),e.jsx(r.Item,{children:e.jsx(c,{type:"primary",htmlType:"submit",block:!0,children:"Оформить заказ"})})]})})}),e.jsxs("div",{className:"order-summary-section he",children:[e.jsxs("div",{className:"",children:[e.jsx("h2",{children:e.jsxs(O,{justify:"space-between",children:[" Корзина ",e.jsx(c,{icon:e.jsx(y,{}),className:"clear-cart-btn",children:"Очистить корзину"})]})}),e.jsx(d,{itemLayout:"horizontal",dataSource:x.items,renderItem:s=>e.jsx(d.Item,{actions:[e.jsxs("div",{className:"rightBar",children:[e.jsx(c,{onClick:()=>f(s.id),style:{width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0px 0px 0px 7px"},type:"text",icon:e.jsx(y,{style:{color:"red"}}),children:"      "}),e.jsx(T,{record:s})]})],children:e.jsx(d.Item.Meta,{avatar:e.jsx(A,{shape:"square",size:"large",style:{height:"100px",width:"100px"},src:s.product.iiko_image}),title:s.product.title,description:e.jsxs("div",{children:[e.jsx("p",{children:s.product.description}),e.jsxs("span",{style:{color:"red"},children:[parseFloat(s.product.price)*s.quantity," c"]})]})})})})]}),e.jsx("br",{}),e.jsxs("div",{className:"promo-code-section",children:[e.jsx("h3",{children:"Введите промо-код:"}),e.jsx(n,{placeholder:"Введите промо-код",value:m,onChange:s=>I(s.target.value),style:{marginBottom:"10px"}}),e.jsx(c,{type:"primary",onClick:P,block:!0,children:"Применить промо-код"})]}),e.jsx("br",{}),e.jsxs("h3",{children:["Итого: ",u," c"]}),e.jsx("div",{className:"order-details",children:e.jsxs("p",{children:["Стоимость товаров: ",u," c"]})}),e.jsx(c,{type:"primary",size:"large",block:!0,children:"Перейти к оплате"})]})]})},L=()=>e.jsxs("div",{children:[e.jsx(E,{children:e.jsx("title",{children:"Mnogosushi | Оформление"})}),e.jsx(D,{})]});export{L as default};
